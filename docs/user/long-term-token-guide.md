# 🔐 长效Token使用指南

## 🎯 什么是长效Token？

长效Token是一种有效期为60天的认证令牌，相比客户端Token（在Cursor客户端退出后失效），长效Token提供了更稳定和持久的认证体验。

## ✨ 长效Token的优势

### 🔄 **自动获取**
- 插件会自动尝试将客户端Token转换为长效Token
- 无需额外操作，完全透明的升级过程

### ⏰ **长期有效**
- **60天有效期** vs 客户端Token的临时性
- 即使Cursor客户端关闭，认证依然有效
- 减少重复登录的麻烦

### 🛡️ **安全可靠**
- 所有Token转换在本地完成
- 不会发送数据到任何外部服务器
- 保持与原有安全标准一致

## 🚀 如何使用长效Token

### 自动获取（推荐）

1. **正常导入账户**
   ```
   使用任意方式导入Cursor账户：
   - 🤖 自动读取
   - 📁 文件上传
   - ✋ 手动输入
   ```

2. **确认授权（重要）**
   ```
   系统会自动打开新标签页，显示Cursor授权页面
   请在页面中点击 "Yes, Log In" 按钮确认授权
   确认后标签页会自动关闭
   ```

3. **观察状态提示**
   ```
   🔄 正在获取长效Token，可能会打开新标签页需要您确认授权...
   ✅ 已获取长效Token，有效期60天
   ⚠️ 使用临时Token: [错误原因]
   ⏰ 用户确认超时，请在新打开的标签页中点击"Yes, Log In"按钮确认授权
   ```

4. **验证Token类型**
   - 在账户列表中查看Token类型标识
   - 长效Token显示为"长效Token (60天)"
   - 临时Token显示为"客户端Token (1天)"

### 手动检查Token状态

1. **打开开发者工具**
   ```
   右键点击插件 → 检查弹出内容 → Console
   ```

2. **执行检查命令**
   ```javascript
   checkTokenStatus()
   ```

3. **查看详细信息**
   ```
   显示Token类型、有效期、过期时间等信息
   ```

## 📊 Token状态说明

### Token类型标识

| 类型 | 显示名称 | 有效期 | 说明 |
|------|----------|--------|------|
| `long_term` | 长效Token (60天) | 60天 | 推荐使用，稳定可靠 |
| `client_token` | 客户端Token (1天) | 1天 | 临时使用，需要Cursor客户端 |

### 状态指示器

- ✅ **绿色**: Token有效且正常
- ⚠️ **黄色**: Token即将过期或有警告
- ❌ **红色**: Token已过期或无效

## 🔧 常见问题解决

### Q: 为什么没有获取到长效Token？

**可能原因**:
1. 未在授权页面点击确认按钮
2. 网络连接问题
3. 客户端Token无效
4. Cursor服务器暂时不可用

**解决方案**:
```
1. 确保在新打开的标签页中点击"Yes, Log In"按钮
2. 检查网络连接
3. 重新从Cursor客户端获取Token
4. 稍后重试
5. 使用临时Token继续工作
```

### Q: 授权页面没有打开怎么办？

**可能原因**:
1. 浏览器阻止了弹出窗口
2. 扩展权限不足

**解决方案**:
```
1. 检查浏览器是否阻止了弹出窗口
2. 在浏览器设置中允许扩展打开新标签页
3. 手动访问授权URL（会在控制台中显示）
```

### Q: 点击了确认按钮但还是失败？

**可能原因**:
1. 网络延迟导致轮询超时
2. 页面加载不完整

**解决方案**:
```
1. 等待页面完全加载后再点击
2. 确保网络连接稳定
3. 重试导入操作
4. 检查浏览器控制台是否有错误信息
```

### Q: 长效Token会自动刷新吗？

**当前版本**: 不会自动刷新，需要手动重新导入

**未来版本**: 计划支持自动刷新功能

**建议**: 在Token过期前重新导入账户

### Q: 如何知道Token即将过期？

**检查方法**:
1. 查看账户列表中的状态指示
2. 使用 `checkTokenStatus()` 命令
3. 观察插件的提示信息

**提前提醒**: 系统会在Token过期前7天开始提醒

### Q: 长效Token失效了怎么办？

**处理步骤**:
1. 重新打开Cursor客户端
2. 确保已登录账户
3. 重新导入账户到插件
4. 系统会自动尝试获取新的长效Token

## 🛠️ 高级功能

### 调试模式

**启用调试模式**:
```javascript
enableDebugMode()
```

**调试功能**:
- 查看详细的Token信息
- 测试Token API连接
- 模拟不同的API响应
- 实时日志查看

**禁用调试模式**:
```javascript
disableDebugMode()
```

### Token管理命令

```javascript
// 检查Token状态
checkTokenStatus()

// 测试Token API
testTokenAPI()

// 查看应用状态
AppState.getState()

// 调试Cookie状态
debugCookieStatus()
```

## 📈 最佳实践

### 1. 定期检查Token状态
- 每周检查一次Token有效期
- 关注插件的状态提示
- 及时处理过期警告

### 2. 备份重要信息
- 记录账户的email和userid
- 保存Cursor客户端的登录信息
- 定期导出账户列表

### 3. 网络环境优化
- 确保稳定的网络连接
- 避免在网络不稳定时导入账户
- 使用有线网络进行重要操作

### 4. 安全注意事项
- 不要分享Token信息
- 定期更换Cursor密码
- 及时清理不需要的账户

## 🔮 未来功能预览

### 计划中的功能
- **自动Token刷新**: Token过期前自动获取新Token
- **批量Token管理**: 一次性管理多个账户的Token
- **Token使用统计**: 查看Token使用情况和历史
- **安全审计**: Token访问日志和安全检查

### 反馈和建议
如果您有任何建议或遇到问题，请：
1. 查看故障排除文档
2. 使用调试工具收集信息
3. 提交详细的问题报告

---

💡 **提示**: 长效Token功能完全在本地运行，不会影响您的隐私和安全。所有Token转换都在您的设备上完成，无需担心数据泄露。
