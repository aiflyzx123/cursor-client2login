# Cursor Deep Token 获取功能使用说明

## 功能概述

新版本的插件支持获取Cursor的深度Token（Deep Token），相比普通的客户端Token，深度Token具有以下优势：

- **更长的有效期**：深度Token有效期为60天，而客户端Token有效期未知
- **独立性**：深度Token在Cursor客户端退出后仍然有效
- **稳定性**：适合长期使用，减少频繁重新认证的需求

## 使用方法

### 1. 选择Token获取模式

在插件的"自动读取"模式中，现在提供了三种Token获取选项：

#### 🔗 客户端Token
- 直接使用Cursor客户端的Token
- 有效期未知，依赖客户端状态
- 适合临时使用或测试

#### 🤖 深度Token-无头模式 (60天有效期)
- 自动获取深度Token，无需用户交互
- 使用Python脚本在后台完成认证流程
- 有效期60天
- **推荐使用此模式**

#### 🌐 深度Token-浏览器模式 (60天有效期)
- 打开浏览器页面确认登录
- 需要用户手动点击确认
- 有效期60天
- 适合需要手动控制的场景

### 2. 自动获取深度Token（无头模式）

1. 确保已安装原生主机程序：
   ```bash
   python3 install_native_host.py
   ```

2. 如果遇到"Native host has exited"错误，请使用具体扩展ID更新配置：
   ```bash
   python3 update_native_host.py [你的扩展ID]
   ```

3. 在插件中选择"🤖 深度Token-无头模式"

4. 点击"🔍 自动读取Cursor数据"按钮

5. 插件会自动：
   - 读取Cursor客户端的认证数据
   - 使用Python脚本获取深度Token
   - 保存新的深度Token到浏览器存储

### 3. 浏览器模式获取深度Token

1. 选择"🌐 深度Token-浏览器模式"

2. 点击"🔍 自动读取Cursor数据"按钮

3. 插件会：
   - 设置客户端Cookie
   - 打开深度登录页面
   - 等待用户确认登录
   - 自动获取新的深度Token
   - 关闭登录页面并保存Token

## Token状态显示

### 当前账户状态
插件会显示当前账户的详细信息：
- Token类型（深度Token或客户端Token）
- 剩余有效天数（如果已知）
- 过期状态提醒

### 账户列表
在账户列表中，每个账户都会显示：
- **深度Token (X天)**：绿色标签，表示深度Token及剩余天数
- **客户端Token**：蓝色标签，表示客户端Token（有效期未知）
- **已过期**：红色标签，表示Token已过期

## 技术实现

### 无头模式流程
1. 获取客户端accessToken和userid
2. 生成PKCE验证参数
3. 构造深度登录URL
4. 模拟浏览器请求，设置认证Cookie
5. 轮询认证结果API
6. 获取深度Token并保存

### 浏览器模式流程
1. 获取客户端数据
2. 设置客户端Cookie
3. 生成深度登录URL并打开新标签页
4. 用户手动确认登录
5. 插件轮询认证结果
6. 获取深度Token、关闭标签页并保存

## 故障排除

### 原生主机连接错误
如果遇到"Native host has exited"错误：

1. **更新原生主机配置**：
   ```bash
   python3 update_native_host.py [你的扩展ID]
   ```

2. **重新安装原生主机**：
   ```bash
   python3 install_native_host.py
   ```

3. **重启Chrome浏览器**

4. **验证安装**：
   ```bash
   python3 install_native_host.py test
   ```

### 无头模式失败
如果无头模式获取深度Token失败，可能的原因：
- 网络连接问题
- 客户端Token已过期
- Cursor服务器临时不可用

**解决方案**：
1. 检查网络连接
2. 重新登录Cursor客户端
3. 尝试使用浏览器模式

### 浏览器模式失败
如果浏览器模式失败，可能的原因：
- 用户未及时确认登录
- 浏览器阻止了弹出窗口
- 认证超时

**解决方案**：
1. 确保及时点击登录确认按钮
2. 允许插件打开新标签页
3. 在60秒内完成登录流程

## 最佳实践

1. **优先使用无头模式**：无需手动操作，更加便捷
2. **定期更新Token**：虽然深度Token有效期长，建议在过期前更新
3. **保留多个账户**：可以保存多个深度Token账户，方便切换使用
4. **监控过期时间**：关注插件显示的剩余天数，及时更新即将过期的Token

## 注意事项

- 深度Token的获取需要有效的客户端Token作为基础
- 无头模式需要安装原生主机程序
- 浏览器模式需要用户手动确认登录
- Token过期后需要重新获取
- 建议在Cursor客户端正常运行时获取深度Token
- 客户端Token的有效期未知，推荐使用深度Token以获得稳定的长期访问 